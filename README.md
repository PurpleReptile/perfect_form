# Perfect Form

### Структура инструкции

* [Шаблоны](#Шаблоны)
* [Подключение](#Подключение)
* [Настройки](#Настройки)
* [Поля](#Поля)
* [reCAPTCHA](#reCAPTCHA)
* [Файлы](#Файлы)
* [Ссылки](#Ссылки)

#### Шаблоны

Все шаблоны форм находятся в папке **templates**, в корне. в папке **templates\mail** два файла:

* ownerMail.html - шаблон для письма владельцу;
* userMail.html - шаблон письма пользователю.

**ownerMail.html** имеет два типа типа переменных:

```html
{{ dataUser }}
{{ dataOwner }}
```

**userMail.html** имеет один тип переменной:

```html
{{ dataUser }}
```

* Тег {{ dataUser }} - изменяется на данные из формы.

* Тег {{ dataOwner }} - изменяется на данные для владельца сайта (ссылка со страницы отправленной формы и id формы).

### Подключение

Чтобы подключить форму для модального окна, необходимо добавить тэг **data-pf-open="nameForm"**, где nameForm - название формы. В данном примере форма подгрузится из **templates\nameForm.html**.

Посмотри примеры, так всё наглядно видно. Для статической формы тупо добавь тег **data-pf-form**. Обязательно нужно указывать id формы. В статической форме ты найдёшь этот тег и id формы. 

В теге **form** есть строка _enctype="multipart/form-data"_ - это нужно для того, чтобы форма могла загружать файлы. В input'е с файлом если добавляешь _multiple_, то доступен мультивыбор файлов. Собственно, как обычно.

### Настройки

Все настройки находятся здесь: **settings\sendForm.json**.

**email**

* **to** - это куда слать, если в форме не будет поля для email;
* **owner** - адресс для дополнительного письма (для владельца сайта);
* **subject** - заголовок письма

**smtp**

Для работы SMTP необходимо ввести сюда учётные данные от яндекса

* **username** - вводишь имя пользователя (без всяких там @yandex.ru)
* **password** - пароль от учётки (сейчас там пусто, удалил свой, письма через smtp не будут отправляться)

**files**

* **extensions** - массив доступных расширений файла
* **max_size** - максимальный размер файла (указывать нужно в байтах). Сейчас там 2Мб (2097152), то есть 2 * 1024 * 1024. 

Дальше идёт поле form: 

по примеру перечисляешь там названия полей, которые в _data-pf-field_, чтобы они были обязательные. Чтобы, даже если из DOM'а можно было удалить обязательные поля, а проверка всё равно происходила по этим полям на стороне сервера.

### Поля

Для поля нужно заполнить type и data-pf-field. Все возможные поля:

* **firstname** - имя
* **surname** - фамилия
* **fullname** - Фамилия Имя Отчество
* **phone** - телефон (сейчас там регулярка - любые цифры, пробел и знак чёрточки)
* **email** - email
* **date** - дата и время (всё в одном поле), использую datetimepicker, всё в одном поле. Указывай этому полю id datetimepicker. И будет всё работать.
* **checkbox** - поле под чекбокс
* **recaptcha** - рекаптча от google. Делай это поле скрытым. Про рекапчу расписано дальше.

Можно добавить новые или удалить старые. Смотри по обстановке. 

Насчёт регулярок - поправлю. Накидал эти для примера. Должны быть русские буквы и для Имение и Фамилии - это одно слово, для ФИО - три, через пробел, про телефон написал, выбор даты - любое число. Туда сложно что-то другое написать будет, но регулярка правится за секунду. С валидацией email всё по стандарту.

Все возможные поля находятся в bsForm.html. Смотри там. Эта самая объёмная форма с полями, служила основой разработки.

### reCAPTCHA

В текущем проекте подключена моя recaptcha. Принцип там такой, что есть два ключа: frontend и backend. Одного клюдча для reCAPTCHA хватает на весь сайт.

```HTML
<!-- reCAPTCHA v3 -->
<script src='https://www.google.com/recaptcha/api.js?render=6LeNyHIUAAAAAEX7wD_srG8r17k67OOPZJwZKFjn'></script>
```

где **6LeNyHIUAAAAAEX7wD_srG8r17k67OOPZJwZKFjn** - fronend ключ. Просто подключи подобный скрипт со своим ключом.

В файле **php\lib\helper\DefaultSettings.php** находятся ключи от серверой и браузерной версии. Туда запиши свои.

```PHP
// client-side google reCAPTCHA v3
const SITE_KEY = "6LeNyHIUAAAAAEX7wD_srG8r17k67OOPZJwZKFjn";

// server-side google reCAPTCHA v3
const SECRET_KEY = "6LeNyHIUAAAAAC8DDIAN0ciu17bLZvnEueCccDXx";
```

В этом файле много настроек:

```PHP
// массив для валидации валидация
const VALIDATION

// email - название поля (отсылка к полю на фронте с тегом data-pf-field)
// regexp - регулярка
// example - пример как заполнять это поле (который появляется при ошибке снизу поля)
// label - название поля в почте
```

### Файлы

Как и описано в ТЗ, они должны сохраняться в корень проекта, в папку report_mail, с конкретной датой и числом.  Если такой папки нет, то программа всё создаст для тебя с правильными правами доступа.

### Ссылки

datetimepicker: https://github.com/xdan/datetimepicker

google reCAPTCHA: https://www.google.com/recaptcha/admin#list